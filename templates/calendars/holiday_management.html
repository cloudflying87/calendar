{% extends 'base.html' %}

{% block title %}Manage Holidays - Calendar {{ calendar.year }}{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">Manage Holidays for {{ calendar.year }}</h1>
    <a href="{% url 'calendars:calendar_detail' year=calendar.year %}" class="btn btn--outline">Back to Calendar</a>
</div>

<div class="holiday-instructions">
    <div class="instruction-card">
        <h3 class="instruction-card__title">Holiday Management</h3>
        <div class="instruction-card__content">
            <p>Select which holidays you want to include in your {{ calendar.year }} calendar. Holidays will be automatically placed on the correct dates:</p>
            <ul style="margin: 1rem 0; padding-left: 1.5rem;">
                <li><strong>New Year's Day:</strong> January 1st</li>
                <li><strong>Easter:</strong> Calculated based on lunar calendar</li>
                <li><strong>Mother's Day:</strong> Second Sunday in May</li>
                <li><strong>Father's Day:</strong> Third Sunday in June</li>
                <li><strong>Memorial Day:</strong> Last Monday in May</li>
                <li><strong>Independence Day:</strong> July 4th</li>
                <li><strong>Labor Day:</strong> First Monday in September</li>
                <li><strong>Thanksgiving:</strong> Fourth Thursday in November</li>
                <li><strong>Christmas:</strong> December 25th</li>
            </ul>
            <p><strong>Note:</strong> You can optionally upload images for each holiday. If no image is provided, the holiday will appear as text only.</p>
        </div>
    </div>
</div>

<div class="form-container">
    <form method="post" enctype="multipart/form-data" class="form holiday-form">
        {% csrf_token %}

        <div class="holiday-table-container">
            <table class="holiday-table">
                <thead>
                    <tr>
                        <th>Include</th>
                        <th>Holiday</th>
                        <th>Date</th>
                        <th>Optional Image</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- New Year's Day -->
                    <tr class="holiday-row" data-holiday="new_years">
                        <td class="holiday-checkbox-cell">
                            {{ form.include_new_years }}
                        </td>
                        <td class="holiday-name">
                            <label for="{{ form.include_new_years.id_for_label }}" class="holiday-label">New Year's Day</label>
                        </td>
                        <td class="holiday-date">January 1, {{ calendar.year }}</td>
                        <td class="holiday-image-cell">
                            <div class="holiday-image-upload" id="image-section-new_years" style="display: none;">
                                {{ form.image_new_years }}
                                <div class="form-help">Upload image (optional)</div>
                            </div>
                        </td>
                    </tr>

                    <!-- Easter -->
                    <tr class="holiday-row" data-holiday="easter">
                        <td class="holiday-checkbox-cell">
                            {{ form.include_easter }}
                        </td>
                        <td class="holiday-name">
                            <label for="{{ form.include_easter.id_for_label }}" class="holiday-label">Easter</label>
                        </td>
                        <td class="holiday-date">{{ holiday_dates.easter }}</td>
                        <td class="holiday-image-cell">
                            <div class="holiday-image-upload" id="image-section-easter" style="display: none;">
                                {{ form.image_easter }}
                                <div class="form-help">Upload image (optional)</div>
                            </div>
                        </td>
                    </tr>

                    <!-- Mother's Day -->
                    <tr class="holiday-row" data-holiday="mothers_day">
                        <td class="holiday-checkbox-cell">
                            {{ form.include_mothers_day }}
                        </td>
                        <td class="holiday-name">
                            <label for="{{ form.include_mothers_day.id_for_label }}" class="holiday-label">Mother's Day</label>
                        </td>
                        <td class="holiday-date">{{ holiday_dates.mothers_day }}</td>
                        <td class="holiday-image-cell">
                            <div class="holiday-image-upload" id="image-section-mothers_day" style="display: none;">
                                {{ form.image_mothers_day }}
                                <div class="form-help">Upload image (optional)</div>
                            </div>
                        </td>
                    </tr>

                    <!-- Father's Day -->
                    <tr class="holiday-row" data-holiday="fathers_day">
                        <td class="holiday-checkbox-cell">
                            {{ form.include_fathers_day }}
                        </td>
                        <td class="holiday-name">
                            <label for="{{ form.include_fathers_day.id_for_label }}" class="holiday-label">Father's Day</label>
                        </td>
                        <td class="holiday-date">{{ holiday_dates.fathers_day }}</td>
                        <td class="holiday-image-cell">
                            <div class="holiday-image-upload" id="image-section-fathers_day" style="display: none;">
                                {{ form.image_fathers_day }}
                                <div class="form-help">Upload image (optional)</div>
                            </div>
                        </td>
                    </tr>

                    <!-- Memorial Day -->
                    <tr class="holiday-row" data-holiday="memorial_day">
                        <td class="holiday-checkbox-cell">
                            {{ form.include_memorial_day }}
                        </td>
                        <td class="holiday-name">
                            <label for="{{ form.include_memorial_day.id_for_label }}" class="holiday-label">Memorial Day</label>
                        </td>
                        <td class="holiday-date">{{ holiday_dates.memorial_day }}</td>
                        <td class="holiday-image-cell">
                            <div class="holiday-image-upload" id="image-section-memorial_day" style="display: none;">
                                {{ form.image_memorial_day }}
                                <div class="form-help">Upload image (optional)</div>
                            </div>
                        </td>
                    </tr>

                    <!-- Independence Day -->
                    <tr class="holiday-row" data-holiday="independence_day">
                        <td class="holiday-checkbox-cell">
                            {{ form.include_independence_day }}
                        </td>
                        <td class="holiday-name">
                            <label for="{{ form.include_independence_day.id_for_label }}" class="holiday-label">Independence Day</label>
                        </td>
                        <td class="holiday-date">July 4, {{ calendar.year }}</td>
                        <td class="holiday-image-cell">
                            <div class="holiday-image-upload" id="image-section-independence_day" style="display: none;">
                                {{ form.image_independence_day }}
                                <div class="form-help">Upload image (optional)</div>
                            </div>
                        </td>
                    </tr>

                    <!-- Labor Day -->
                    <tr class="holiday-row" data-holiday="labor_day">
                        <td class="holiday-checkbox-cell">
                            {{ form.include_labor_day }}
                        </td>
                        <td class="holiday-name">
                            <label for="{{ form.include_labor_day.id_for_label }}" class="holiday-label">Labor Day</label>
                        </td>
                        <td class="holiday-date">{{ holiday_dates.labor_day }}</td>
                        <td class="holiday-image-cell">
                            <div class="holiday-image-upload" id="image-section-labor_day" style="display: none;">
                                {{ form.image_labor_day }}
                                <div class="form-help">Upload image (optional)</div>
                            </div>
                        </td>
                    </tr>

                    <!-- Thanksgiving -->
                    <tr class="holiday-row" data-holiday="thanksgiving">
                        <td class="holiday-checkbox-cell">
                            {{ form.include_thanksgiving }}
                        </td>
                        <td class="holiday-name">
                            <label for="{{ form.include_thanksgiving.id_for_label }}" class="holiday-label">Thanksgiving</label>
                        </td>
                        <td class="holiday-date">{{ holiday_dates.thanksgiving }}</td>
                        <td class="holiday-image-cell">
                            <div class="holiday-image-upload" id="image-section-thanksgiving" style="display: none;">
                                {{ form.image_thanksgiving }}
                                <div class="form-help">Upload image (optional)</div>
                            </div>
                        </td>
                    </tr>

                    <!-- Christmas -->
                    <tr class="holiday-row" data-holiday="christmas">
                        <td class="holiday-checkbox-cell">
                            {{ form.include_christmas }}
                        </td>
                        <td class="holiday-name">
                            <label for="{{ form.include_christmas.id_for_label }}" class="holiday-label">Christmas</label>
                        </td>
                        <td class="holiday-date">December 25, {{ calendar.year }}</td>
                        <td class="holiday-image-cell">
                            <div class="holiday-image-upload" id="image-section-christmas" style="display: none;">
                                {{ form.image_christmas }}
                                <div class="form-help">Upload image (optional)</div>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        {% if form.non_field_errors %}
            <div class="form-errors">
                {% for error in form.non_field_errors %}
                    <div class="form-error">{{ error }}</div>
                {% endfor %}
            </div>
        {% endif %}

        <div class="form-actions">
            <button type="submit" class="btn btn--primary">Save Holiday Selections</button>
            <a href="{% url 'calendars:calendar_detail' year=calendar.year %}" class="btn btn--outline">Cancel</a>
        </div>
    </form>
</div>

<style>
.holiday-form {
    max-width: none;
}

.holiday-table-container {
    margin-bottom: 2rem;
    overflow-x: auto;
}

.holiday-table {
    width: 100%;
    border-collapse: collapse;
    background: var(--color-background-light);
    border: 1px solid var(--color-border);
    border-radius: var(--border-radius);
}

.holiday-table th {
    background: var(--color-background);
    padding: 1rem;
    text-align: left;
    font-weight: 600;
    color: var(--color-text-primary);
    border-bottom: 1px solid var(--color-border);
}

.holiday-table th:first-child {
    width: 80px;
    text-align: center;
}

.holiday-table th:nth-child(2) {
    width: 200px;
}

.holiday-table th:nth-child(3) {
    width: 180px;
}

.holiday-table th:last-child {
    min-width: 200px;
}

.holiday-row {
    transition: background-color var(--transition-fast);
}

.holiday-row:hover {
    background: rgba(37, 99, 235, 0.03);
}

.holiday-row.selected {
    background: rgba(37, 99, 235, 0.05);
}

.holiday-table td {
    padding: 1rem;
    border-bottom: 1px solid var(--color-border);
    vertical-align: top;
}

.holiday-checkbox-cell {
    text-align: center;
    vertical-align: middle;
}

.holiday-checkbox-cell input[type="checkbox"] {
    width: auto;
    margin: 0;
}

.holiday-name {
    vertical-align: middle;
}

.holiday-label {
    font-weight: 600;
    color: var(--color-text-primary);
    font-size: 1rem;
    margin: 0;
    cursor: pointer;
}

.holiday-date {
    font-size: 0.875rem;
    color: var(--color-text-secondary);
    vertical-align: middle;
}

.holiday-image-cell {
    min-width: 200px;
}

.holiday-image-upload {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.holiday-image-upload input[type="file"] {
    font-size: 0.875rem;
}

.holiday-image-upload .form-help {
    font-size: 0.75rem;
    color: var(--color-text-secondary);
    margin: 0;
}

@media (max-width: 768px) {
    .holiday-table th:nth-child(3),
    .holiday-table td:nth-child(3) {
        display: none;
    }

    .holiday-table th:last-child,
    .holiday-table td:last-child {
        min-width: 150px;
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Holiday dates for {{ calendar.year }}
    const holidayDates = {
        'new_years': 'January 1, {{ calendar.year }}',
        'independence_day': 'July 4, {{ calendar.year }}',
        'christmas': 'December 25, {{ calendar.year }}',
        // These would need to be calculated server-side for accuracy
        'easter': 'Easter {{ calendar.year }}',
        'mothers_day': 'Second Sunday in May {{ calendar.year }}',
        'fathers_day': 'Third Sunday in June {{ calendar.year }}',
        'memorial_day': 'Last Monday in May {{ calendar.year }}',
        'labor_day': 'First Monday in September {{ calendar.year }}',
        'thanksgiving': 'Fourth Thursday in November {{ calendar.year }}'
    };

    // Set holiday dates
    Object.keys(holidayDates).forEach(function(holiday) {
        const dateElement = document.getElementById('date-' + holiday);
        if (dateElement) {
            dateElement.textContent = holidayDates[holiday];
        }
    });

    // Handle checkbox changes
    document.querySelectorAll('input[type="checkbox"]').forEach(function(checkbox) {
        const holidayCode = checkbox.name.replace('include_', '');
        const imageSection = document.getElementById('image-section-' + holidayCode);
        const holidayRow = checkbox.closest('.holiday-row');

        // Initial state
        if (checkbox.checked) {
            if (imageSection) imageSection.style.display = 'flex';
            if (holidayRow) holidayRow.classList.add('selected');
        }

        checkbox.addEventListener('change', function() {
            if (this.checked) {
                if (imageSection) imageSection.style.display = 'flex';
                if (holidayRow) holidayRow.classList.add('selected');
            } else {
                if (imageSection) imageSection.style.display = 'none';
                if (holidayRow) holidayRow.classList.remove('selected');
                // Clear the file input if unchecked
                const fileInput = imageSection ? imageSection.querySelector('input[type="file"]') : null;
                if (fileInput) fileInput.value = '';
            }
        });
    });
});
</script>
{% endblock %}