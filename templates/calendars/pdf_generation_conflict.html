{% extends 'base.html' %}

{% block title %}PDF Already Exists - Calendar {{ calendar.year }}{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">PDF Generation Conflict</h1>
    <a href="{% url 'calendars:calendar_detail' year=calendar.year %}" class="btn btn--outline">Back to Calendar</a>
</div>

<div class="conflict-modal-container">
    <div class="conflict-modal">
        <div class="conflict-modal__header">
            <h2 class="conflict-modal__title">ðŸ“„ PDF Already Exists</h2>
            <p class="conflict-modal__subtitle">
                A <strong>{{ generation_type_display }}</strong> PDF already exists for calendar {{ calendar.year }}.
            </p>
        </div>

        <div class="conflict-modal__content">
            <div class="existing-pdf-info">
                <div class="pdf-info-card">
                    <div class="pdf-info-card__icon">ðŸ“…</div>
                    <div class="pdf-info-card__content">
                        <h4>Existing PDF</h4>
                        <p><strong>Type:</strong> {{ generation_type_display }}</p>
                        <p><strong>Created:</strong> {{ existing_calendar.created_at|date:"M j, Y g:i A" }}</p>
                        <p><strong>Calendar:</strong> {{ calendar.year }}</p>
                    </div>
                </div>
            </div>

            <div class="conflict-options">
                <h3>What would you like to do?</h3>

                <div class="option-cards">
                    <form method="post" class="option-form">
                        {% csrf_token %}
                        <input type="hidden" name="generation_type" value="{{ generation_type }}">
                        <input type="hidden" name="action" value="overwrite">

                        <button type="submit" class="option-card option-card--overwrite">
                            <div class="option-card__icon">ðŸ”„</div>
                            <div class="option-card__content">
                                <h4>Replace Existing PDF</h4>
                                <p>Generate a new PDF and replace the existing one. The old PDF will be permanently deleted.</p>
                                <div class="option-card__badge">Recommended</div>
                            </div>
                        </button>
                    </form>

                    <form method="post" class="option-form">
                        {% csrf_token %}
                        <input type="hidden" name="generation_type" value="{{ generation_type }}">
                        <input type="hidden" name="action" value="create_new">

                        <button type="submit" class="option-card option-card--new">
                            <div class="option-card__icon">âœ¨</div>
                            <div class="option-card__content">
                                <h4>Generate New PDF</h4>
                                <p>Create a new PDF and delete the old one. This has the same effect as replacing but creates a fresh record.</p>
                            </div>
                        </button>
                    </form>
                </div>

                <div class="conflict-actions">
                    <a href="{% url 'calendars:calendar_detail' year=calendar.year %}" class="btn btn--outline">
                        Cancel
                    </a>
                    <a href="{% url 'calendars:download_calendar' year=calendar.year generation_type=generation_type %}" class="btn btn--secondary">
                        ðŸ“¥ Download Existing PDF
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.conflict-modal-container {
    display: flex;
    justify-content: center;
    align-items: flex-start;
    min-height: 60vh;
    padding: 2rem 0;
}

.conflict-modal {
    background: var(--color-bg-primary);
    border-radius: var(--border-radius-lg);
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
    max-width: 600px;
    width: 100%;
    margin: 0 1rem;
    border: 1px solid var(--color-border);
}

.conflict-modal__header {
    padding: 2rem 2rem 1rem;
    text-align: center;
    border-bottom: 1px solid var(--color-border);
}

.conflict-modal__title {
    margin: 0 0 0.5rem;
    color: var(--color-text-primary);
    font-size: 1.5rem;
    font-weight: 600;
}

.conflict-modal__subtitle {
    margin: 0;
    color: var(--color-text-secondary);
    font-size: 1rem;
    line-height: 1.5;
}

.conflict-modal__content {
    padding: 2rem;
}

.existing-pdf-info {
    margin-bottom: 2rem;
}

.pdf-info-card {
    display: flex;
    align-items: center;
    padding: 1.5rem;
    background: var(--color-bg-secondary);
    border-radius: var(--border-radius);
    border: 1px solid var(--color-border);
}

.pdf-info-card__icon {
    font-size: 2rem;
    margin-right: 1rem;
    flex-shrink: 0;
}

.pdf-info-card__content h4 {
    margin: 0 0 0.5rem;
    color: var(--color-text-primary);
    font-weight: 600;
}

.pdf-info-card__content p {
    margin: 0.25rem 0;
    color: var(--color-text-secondary);
    font-size: 0.9rem;
}

.conflict-options h3 {
    margin: 0 0 1.5rem;
    color: var(--color-text-primary);
    font-weight: 600;
}

.option-cards {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    margin-bottom: 2rem;
}

.option-form {
    margin: 0;
}

.option-card {
    display: flex;
    align-items: flex-start;
    padding: 1.5rem;
    background: var(--color-bg-primary);
    border: 2px solid var(--color-border);
    border-radius: var(--border-radius);
    cursor: pointer;
    transition: all 0.2s ease;
    text-align: left;
    width: 100%;
    text-decoration: none;
    color: inherit;
    position: relative;
}

.option-card:hover {
    border-color: var(--primary-color);
    background: var(--color-bg-secondary);
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
}

.option-card--overwrite:hover {
    border-color: var(--primary-color);
}

.option-card--new:hover {
    border-color: var(--secondary-color);
}

.option-card__icon {
    font-size: 1.5rem;
    margin-right: 1rem;
    flex-shrink: 0;
    margin-top: 0.25rem;
}

.option-card__content h4 {
    margin: 0 0 0.5rem;
    color: var(--color-text-primary);
    font-weight: 600;
}

.option-card__content p {
    margin: 0;
    color: var(--color-text-secondary);
    line-height: 1.5;
    font-size: 0.9rem;
}

.option-card__badge {
    position: absolute;
    top: 0.75rem;
    right: 0.75rem;
    background: var(--primary-color);
    color: white;
    padding: 0.25rem 0.5rem;
    border-radius: var(--border-radius-sm);
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.conflict-actions {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 1rem;
    padding-top: 1.5rem;
    border-top: 1px solid var(--color-border);
}

@media (max-width: 768px) {
    .conflict-modal {
        margin: 0 0.5rem;
    }

    .conflict-modal__header,
    .conflict-modal__content {
        padding: 1.5rem;
    }

    .pdf-info-card,
    .option-card {
        padding: 1rem;
    }

    .option-card__content p {
        font-size: 0.85rem;
    }

    .conflict-actions {
        flex-direction: column;
        gap: 0.75rem;
    }

    .conflict-actions .btn {
        width: 100%;
        text-align: center;
    }
}

@media (max-width: 480px) {
    .conflict-modal__title {
        font-size: 1.25rem;
    }

    .option-cards {
        gap: 0.75rem;
    }

    .option-card__icon {
        font-size: 1.25rem;
    }

    .option-card__badge {
        position: static;
        margin-top: 0.5rem;
        align-self: flex-start;
    }
}
</style>
{% endblock %}